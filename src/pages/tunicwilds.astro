---
import Layout from "../layouts/Layout.astro";
import TunicwildsApp from "../components/Tunicwilds/Tunicwilds.svelte";
import db from "../database/db";
import { Tunicwild } from "../database/schema";

export const prerender = false;

if (!process.env.TUNICWILDS_UPLOAD_DIRECTORY) {
    Astro.response.status = 500;
    Astro.response.statusText =
        "TUNICWILDS_UPLOAD_DIRECTORY environment variable is not set";
}

const startDate = new Date("2025-06-14");
const date = new Date();

const songList = await db.select().from(Tunicwild);

// Get the song for today's challenge
// Really shitty placeholder
const songData =
    songList[
        Math.floor(
            ((date.getTime() - startDate.getTime()) / (1000 * 60 * 60 * 24)) %
                songList.length
        )
    ];
---

<Layout
    title="Tunicwilds"
    description="CAN YOU GUESS THE SONG? CAN YOU GUESS THE GAME? CAN YOU GUESS THE TUNICWILDS?"
>
    {songData && <TunicwildsApp {songData} {songList} client:visible />}
</Layout>
