---
import Layout from "../_Layout.astro";
import "../../../styles/corp-submission-forms.css";
---

<Layout>
    <h1>Submit a Sight üñºÔ∏è</h1>
    <p>
        Upload images (or a zip) for a sight. We will split spritesheets the
        same way the bot does.
    </p>

    <form
        id="sight-form"
        action="/corp/api/sights"
        method="post"
        enctype="multipart/form-data"
    >
        <label>
            Title
            <input type="text" name="title" required />
        </label>

        <label>
            Description
            <textarea name="description" rows="3" required></textarea>
        </label>

        <label>
            Tags (comma separated)
            <input type="text" name="tags" />
        </label>

        <label>
            Images or Zip (1 MB per file)
            <input
                type="file"
                name="assets"
                accept="image/png,image/jpeg,image/gif,application/zip"
                multiple
                required
            />
        </label>

        <label class="checkbox">
            <input type="checkbox" name="pixelated" />
            Mark as pixel art
        </label>

        <label class="checkbox">
            <input type="checkbox" name="colour" checked />
            Show colour for this sight
        </label>

        <label class="checkbox">
            <input type="checkbox" name="confirmInformation" required />
            I confirm the information is correct
        </label>

        <label class="checkbox">
            <input type="checkbox" name="confirmOwnWork" required />
            This is my own work
        </label>

        <button type="submit" class="submit-button">
            <span class="button-text">Submit Sight</span>
            <span class="button-spinner" style="display: none;">‚è≥</span>
        </button>
    </form>

    <div id="upload-progress" class="upload-progress" style="display: none;">
        <div class="progress-bar">
            <div class="progress-fill"></div>
        </div>
        <p class="progress-text">Uploading... 0%</p>
    </div>

    <p id="sight-status" class="status" role="status" aria-live="polite"></p>
</Layout>

<script type="module">
    import { setupFormHandler } from "../../../components/corp/formHandler";

    setupFormHandler({
        formId: "sight-form",
        statusId: "sight-status",
        progressId: "upload-progress",
        successMessage: "‚úÖ Sight uploaded successfully!",
        useXHR: true,
        validateFn: (form) => {
            const assetInputs = form.querySelectorAll('input[name="assets"]');
            let hasAsset = false;
            assetInputs.forEach((input) => {
                if (
                    input instanceof HTMLInputElement &&
                    input.files &&
                    input.files.length > 0
                )
                    hasAsset = true;
            });

            if (!hasAsset) {
                return "Please attach at least one image or zip";
            }
            return null;
        },
    });
</script>


