---
import Layout from "../_Layout.astro";
import "../../../styles/corp-submission-forms.css";
---

<Layout>
    <h1>Submit a Motion üé¨</h1>
    <p>
        Upload a motion video. We will forward it to the same processors that
        the Discord bot uses.
    </p>

    <form
        id="motion-form"
        action="/corp/api/motions"
        method="post"
        enctype="multipart/form-data"
    >
        <label>
            Title
            <input type="text" name="title" required />
        </label>

        <label>
            Description
            <textarea name="description" rows="3"></textarea>
        </label>

        <label>
            Tags (comma separated)
            <input type="text" name="tags" />
        </label>

        <label>
            Video File
            <input type="file" name="video" accept="video/*" required />
        </label>

        <label>
            Thumbnail (optional)
            <input type="file" name="thumbnail" accept="image/png,image/jpeg" />
        </label>

        <label class="checkbox">
            <input type="checkbox" name="allowYoutubeShorts" />
            Allow YouTube Shorts
        </label>

        <label class="checkbox">
            <input type="checkbox" name="colour" checked />
            Show colour for this motion
        </label>

        <label class="checkbox">
            <input type="checkbox" name="confirmInformation" required />
            I confirm the information is correct
        </label>

        <label class="checkbox">
            <input type="checkbox" name="confirmOwnWork" required />
            This is my own work
        </label>

        <button type="submit" class="submit-button">
            <span class="button-text">Submit Motion</span>
            <span class="button-spinner" style="display: none;">‚è≥</span>
        </button>
    </form>

    <div id="upload-progress" class="upload-progress" style="display: none;">
        <div class="progress-bar">
            <div class="progress-fill"></div>
        </div>
        <p class="progress-text">Uploading... 0%</p>
    </div>

    <p id="motion-status" class="status" role="status" aria-live="polite"></p>
</Layout>

<script type="module">
    import { setupFormHandler } from "../../../components/corp/formHandler";

    setupFormHandler({
        formId: "motion-form",
        statusId: "motion-status",
        progressId: "upload-progress",
        successMessage: "‚úÖ Motion uploaded successfully!",
        useXHR: true,
        validateFn: (form) => {
            const videoInput = form.querySelector('input[name="video"]');
            if (
                !(videoInput instanceof HTMLInputElement) ||
                !videoInput.files ||
                videoInput.files.length === 0
            ) {
                return "Please attach a video file";
            }
            return null;
        },
    });
</script>


