---
import Layout from "../_Layout.astro";
import "../../../styles/corp-submission-forms.css";

const markdownLimit = 2 ** 20;
---

<Layout>
    <h1>Submit Words üìù</h1>
    <p>
        Paste Markdown content for a words post and optionally include a zip of
        assets.
    </p>

    <form
        id="word-form"
        action="/corp/api/words"
        method="post"
        enctype="multipart/form-data"
        data-markdown-limit={markdownLimit}
    >
        <label>
            Title
            <input type="text" name="title" required />
        </label>

        <label>
            Markdown
            <textarea name="md" rows="10" required></textarea>
        </label>

        <label>
            Tags (comma separated)
            <input type="text" name="tags" />
        </label>

        <label>
            Optional Assets Zip
            <input type="file" name="assets" accept="application/zip" />
        </label>

        <label class="checkbox">
            <input type="checkbox" name="colour" checked />
            Show colour for this entry
        </label>

        <label class="checkbox">
            <input type="checkbox" name="confirmInformation" required />
            I confirm the information is correct
        </label>

        <label class="checkbox">
            <input type="checkbox" name="confirmOwnWork" required />
            This is my own work
        </label>

        <button type="submit" class="submit-button">
            <span class="button-text">Submit Words</span>
            <span class="button-spinner" style="display: none;">‚è≥</span>
        </button>
    </form>

    <p id="word-status" class="status" role="status" aria-live="polite"></p>
</Layout>

<script>
    import { setupFormHandler } from "../../../components/corp/formHandler";

    const form = document.getElementById("word-form");
    const markdownLimit =
        form instanceof HTMLFormElement && form.dataset.markdownLimit
            ? Number(form.dataset.markdownLimit)
            : 2 ** 20;

    setupFormHandler({
        formId: "word-form",
        statusId: "word-status",
        successMessage: "‚úÖ Words submitted successfully!",
        validateFn: (form) => {
            const markdownInput = form.querySelector('textarea[name="md"]');
            if (!(markdownInput instanceof HTMLTextAreaElement)) {
                return "Markdown textarea not found";
            }

            const markdown = markdownInput.value;
            if (!markdown.trim()) {
                return "Markdown content is required";
            }

            if (markdown.length > markdownLimit) {
                return `Markdown must be under ${markdownLimit} characters`;
            }

            return null;
        },
    });
</script>

<style>
    textarea[name="md"] {
        font-family: monospace;
    }
</style>
